
<script>
  var id= '<%=project.id%>';
  var email_user = '<%= session.User.email%>';
  var miid='<%=session.User.id%>'
  var own_email = '<%= project.owner_email%>';
  var $mensaje1 = $('<span class="  color_acentuado-text"> Se agregó el nuevo usuario al proyecto</span>');
  $(document).ready(function(){
    $('.tooltipped').tooltip({delay: 50});
     $('.modal-trigger').leanModal();
  });
  var $mensaje2 = $('<span class="  color_acentuado-text"> Se agregaron los nuevos usuarios al proyecto</span>');
</script>


  <div class="row" ng-controller="projectedit">
    <div class="col s12">
      <ul class="tabs">
        <li class="tab col s3"><a  href="#participantes">Participantes</a></li>
        <li class="tab col s3"><a   href="#dialogo">Diálogo</a></li>
        <li class="tab col s3 "><a class="active" href="#mensajes"> Mensajes</a></li>
        <li class="tab col s3 "><a href="#kanban"> Kanban</a></li>
      </ul>
    </div>
   <!-- Inicio TABS-->
    <div id="participantes" class="col s12">
      <div class="row container">
        <br>
        <%if(session.User.email==project.owner_email){%>
          <div class="row col s12">
            <h6 class="green-text"> Estas a cargo del proyecto, puedes editarlo  <a href="#"> aquí</a></h6>
          </div>
          <div class="row col s12">
            <!-- Selectize -->
                <div class= "row col s8">
                  <selectize config='myConfig' options='usuarios' ng-model="inputdatos"></selectize>
                </div>
                <div class="row col s4">
                     <button type="submit" class="waves-effect waves-light  light-green  btn-large" ng-click="sendData()"> Agregar usuarios </button>
                </div>

               <!-- Selectize -->
          </div>
        <%}%>
          <div class="col s12">
            <div class="col s1 ">
              <br>
              <i class="material-icons light-green-text prefix">search</i>
            </div>
            <div class="col s4 input-field">
              <input type="search" ng-model="busqueda" id="search" >
              <label for="search" class="green-text"> Buscar participante</label>
            </div>
          </div>
          <div class=" col s12">
                <!-- Tabla -->
            <div class="" id="tabla_participantes">
              <table class="striped  responsive-table">
                <thead> 
                  <tr>
                    <th class="light-green-text" > </th>
                    <th data-field="nombre" class="light-green-text">Nombre </th>
                    <th data-field="correo" class="light-green-text">Correo </th>
                    <th data-field="rut" class="light-green-text"> Rut </th>
                    <th data-field="owner" class="light-green-text"> PMO</th>
                    <th data-field="encargado" class="light-green-text"> Encargado</th>
                    <th data-field="owner" class="light-green-text"> Rol</th>
                  </tr>
                </thead> 
                <tbody>
                  <tr ng-repeat="x in misparticipantes | filter:busqueda" ng-model="misparticipantes">
                    <td >  <img ng-src="{{x.imgurl}}" alt="" class="circle " height ="40px" weight="40px"></div>
                    </td>
                    <td class="light-green-text"> {{ x.firstname }} {{ x.lastname }}</td>
                    <td class="light-green-text"> {{ x.email  }}</td>
                    <td class="light-green-text"> {{x.rut}} </td>
                    <td>   <i class= "green-text small material-icons prefix" ng-if="owner_email==x.email">done</i></td>  
                    <td><i class= "green-text small material-icons prefix" ng-if="owner_email==x.email">done</i></td>
                    <td class="light-green-text">Desarrollador Front end</td>
                  </tr>  
                </tbody>
            </table>
            </div>
            <!-- Tabla -->  
          </div>
        </div>
        

    </div><!-- FIN TAB -->

    <div id="dialogo" class="col s12">

          <style>
            .node circle {     
              fill: #fff;    
              stroke: steelblue;    
              stroke-width: 1.5px; 
            } 
            .node {    
              font: 20px sans-serif; 
            } 
            .link {    
              fill: none;    
              stroke: #ccc;    
              stroke-width: 1.5px; 
            }
            </style> 
            <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
            <script type="text/javascript"> 
            var width = 1000; 
            var height = 600; 
            var cluster = d3.layout.cluster()    
               .size([height, width-200]); 
            var diagonal = d3.svg.diagonal()    
               .projection (function(d) { return [d.y, d.x];}); 
            var svg = d3.select("#dialogo").append("svg")    
               .attr("width",width)    
               .attr("height",height)    
               .append("g")    
               .attr("transform","translate(100,0)"); 
            d3.json("http://localhost:1337/project/getDialogos/<%=project.id%>", function(error, root){    
               var nodes = cluster.nodes(root);    
               var links = cluster.links(nodes);    
               var link = svg.selectAll(".link")       
                  .data(links)       
                  .enter().append("path")       
                  .attr("class","link")       
                  .attr("d", diagonal);     
               var node = svg.selectAll(".node")       
                  .data(nodes)       
                  .enter().append("g")       
                  .attr("class","node")       
                  .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; });    
               node.append("circle")       
                  .attr("r", 4.5);    
               node.append("text")       
                  .attr("dx", function(d) { return d.children ? -8 : 8; })       
                  .attr("dy", 3)       
                  .style("text-anchor", function(d) { return d.children ? "end" : "start"; })      
                  .text( function(d){ return d.name;}); 
            }); 
            </script>
          <!--
                 <div class="principalproject" id="contenedor principal">
        <div class="contenedor_dialogo card">
        <form action="/dialogo/create/" method="post" novalidate class="row">
          para crear root
          <input type="text" name="name">
          <label for="name"> Nombre del dialogo</label>
          <input type="hidden" value="true" name="root">
          <input type="hidden" name="project_id" value="<%=project.id%>">
          <input type="hidden" name="_csrf" value="<%=_csrf%>">
          <button type="submit">
            Enviar 
          </button>
        </form>

      OTra form
        <form action="/dialogo/add_dialogo/" method="post" novalidate class="row">
          para unir 
          
          <input type="hidden"  name="id_dialogo" value="5753bf818f7d89371752f517">
          <input type="hidden" name="id_nuevo" value="5753bfb58f7d89371752f519">
          <input type="hidden" name="_csrf" value="<%=_csrf%>">
          <button type="submit">
            Enviar union
          </button>
        </form>
        nuevo form
          <form action="/dialogo/buscar/" method="post" novalidate class="row">
         ultimo

          <input type="hidden" name="_csrf" value="<%=_csrf%>">
            <input type="hidden" name="project_id" value="<%=project.id%>">
          <button type="submit">
            ultimo union
          </button>
        </form>
      </div>
      </div>
      -->

    </div><!-- FIN TAB -->

    <div id="mensajes" class="col s12">
    <div class="row col s12" ng-repeat="x in mensajes">
      <div class="row col s4 ">
        <div class="card green">
          <span>  {{x.id}} : {{x.name}} </span>
           <button  ng-click="seleccionar(x)" type="submit">
            Enviar 
          </button>
        </div>
      </div>
    </div>
  aca va el seleccionado {{seleccionado}}
    <form novalidate class="row">
          para crear mensaje de respuesta
          <input type="text" name="name" ng-model="respuesta">
          <label for="name"> Nombre del dialogo</label>
          <input type="text" name="padre" ng-model="idmensajepadre" >
          <label for="padre"> id del padre</label>
          <input type="hidden" name="tipo" value="duda" ng-model="tiposeleccionado">
          
          <button  ng-click="sendMessage()" type="submit">
            Enviar 
          </button>
        </form>








    </div><!-- FIN TAB -->

    <div id="kanban" class="col s12">Soy el kanban
    </div><!-- FIN TAB -->
  </div><!-- FIN CONTENEDOR DIV -->














