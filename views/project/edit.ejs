

<script>

var REGEX_EMAIL = '([a-z0-9!#$%&\'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&\'*+/=?^_`{|}~-]+)*@' +
                  '(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)';


app.controller('projectedit',function($scope,$http,$timeout){
$scope.usuarios = [];
$http.get('http://localhost:1337/user/getAllEmail/')
  .then(function(result) {
    $scope.usuarios = result.data;
    });

$scope.inputdatos = '';
$scope.myConfig = {
  create: false,
  persist:false,
  valueField: 'email',
  labelField: 'firstname',
  delimiter: '|',
  placeholder: 'Seleccione un correo',
  searchField: ['firstname','email'],

    createFilter: function(input) {
        var match, regex;

        // email@address.com
        regex = new RegExp('^' + REGEX_EMAIL + '$', 'i');
        match = input.match(regex);
        if (match) return !this.options.hasOwnProperty(match[0]);

        // name <email@address.com>
        regex = new RegExp('^([^<]*)\<' + REGEX_EMAIL + '\>$', 'i');
        match = input.match(regex);
        if (match) return !this.options.hasOwnProperty(match[2]);

        return false;
    },
render: {
        item: function(item, escape) {
            return '<div>' +
                (item.firstname ? '<span class="name">' + escape(item.firstname+' , ') + '</span>' : '') +
                (item.email ? '<span class="email">' + escape(item.email) + '</span>' : '') +
            '</div>';
        },
        option: function(item, escape) {
            var label = item.firstname || item.email;
            var caption = item.firstname ? item.email : null;
            return '<div>' +
                '<span class="label">' + escape(label+' , ') + '</span>' +
                (caption ? '<span class="caption">' + escape(caption) + '</span>' : '') +
            '</div>';
        }
    },


  onInitialize: function(selectize){
    // receives the selectize object as an argument
      console.log('Initialized',selectize);
  },
  maxItems: 5
};


});

</script>

 <nav container>
    <div class="nav-wrapper green darken-2 border_estilo ">
      <div class="col s12">
        <a href="/user/view/<%=session.User.id%>" class="breadcrumb">Mis proyectos</a>
        <a href="/project/edit/<%=project.id%>" class="breadcrumb">Projecto: <%= project.name%></a>        
      </div>
    </div>
  </nav>






 <div class = "carta" ng-controller="projectedit">
  <selectize config='myConfig' options='usuarios.arr' ng-model="inputdatos"></selectize>
  
 <p>
      <b>ngModel2:</b>
      <pre>{{inputdatos |json}}</pre>
    </p>
    


  <h5> Projecto: <%= project.name%> </h3>
    <!--<h1> Hola soy el <%= project.id%></h1>
    <h1> HOla soy el usuario <%=session.User.id%></h1>-->
    <% if(flash && flash.err){ %>
<ul>
  <% Object.keys(flash.err).forEach(function(error){ %>
  <li><%= JSON.stringify(flash.err[error])%></li>
  <%})%>
</ul>
<% } %>

            

    <form class="col s12" action = "/project/add_user/<%=project.id%>" method = "post">    
           <div class="row">
        <div class="input-field  col s6">
          <input id="email"  type="email" class="validate" name="email">
          <label for="email">Email Usuario</label>
        </div>
      </div>
         
          <input id="id_project" name= "id_project" type="hidden" class="validate" value="<%=project.id%>">
          <input id="user_id" name= "user_id" type="hidden" class="validate" value="<%=session.User.id%>">
          <input id="project_id" name= "project_id" type="hidden" class="validate" value="<%=project.id%>">
      <button type="submit" class="waves-effect waves-light btn-large" value="Crear cuenta"> AÃ±adir Usuario </button>
      <input type="hidden" name="_csrf" value="<%= _csrf%>"/>
    </form>
  
  <br>
  </div>  

  <div class="carta">
    <h5> Participantes del projecto</h3>

      <table class="striped">
        <thead> 
    <tr>
      <th data-field="nombre">Nombre </th>
      <th data-field="apellidos">Apellidos </th>
      <th data-field="correo">Correo </th>


    </tr>
        </thead> 

    <% _.each(project.participants, function(participants){%>
   <tr data-id="<%=participants.id %>" data-model="participants">
      <td> <%= participants.firstame %> </td>
      <td> <%= participants.lastname %> </td>
      <td> <%= participants.email %> </td>
     
      </tr>
    
      <% })%>
  </table>






  </div>









